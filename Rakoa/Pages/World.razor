@page "/World"

@using System.Text.Json;
@using System.Text.Json.Serialization;
@using System.IO;

@inject Services.MagicSiteServices.WebsiteConfig config

@if (worldSections == null)
{
    <p class="loading-bar">@config.info.loadingText</p>
}
else
{
    <div class="page-tab-selector">
        @{ int finalIndex = 0; }
        @for (int i = 0; i < worldSections.Length; i++)
        {
            int iLock = i;
            <button class="@(selectedIndex == iLock ? "active" : "")" @onclick="@(e => selectedIndex = iLock)">
                @worldSections[iLock].sectionName
            </button>
            finalIndex = i;
        }
        @{finalIndex++;}
        <button class="@(selectedIndex == finalIndex ? "active" : "")" @onclick="@(e=> selectedIndex = finalIndex)">
            Map
        </button>
    </div>

    @for (int i = 0; i < worldSections.Length; i++)
    {
        int iLock = i;
        <WorldSection Title="@worldSections[iLock].sectionName" JsonFileName="@worldSections[iLock].sectionJSONName" Description="@worldSections[iLock].sectionDescription" Displayed="@(selectedIndex == iLock)" />
    }
    if (selectedIndex == finalIndex)
    {
        <div class="content-box">
            <h2>Rakoa Map</h2>
            <p>(Click to go to a version with more features.)</p>
            <a href="https://inkarnate.com/m/4L0b2y--rakoa/" target="_blank"><img class="world-map" src="/Rakoa.jpg" /></a>
        </div>
    }

}
@code {
    private class WorldSectionInfo
    {
        public string sectionName { get; set; }
        public string sectionJSONName { get; set; }
        public string sectionDescription { get; set; }
    }

    private WorldSectionInfo[] worldSections;

    private int selectedIndex = 0;

    protected override async Task OnInitializedAsync()
    {
        using (FileStream fs = File.OpenRead("wwwroot/website_info/worldsections.json"))
        {
            worldSections = await JsonSerializer.DeserializeAsync<WorldSectionInfo[]>(fs);
        }
    }
}